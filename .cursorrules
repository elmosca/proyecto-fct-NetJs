# Reglas para el Agente de Cursor - Proyecto FCT NetJS
# Entorno HÃ­brido: Windows (Desarrollo) + WSL (Servicios Docker)

## ğŸ¯ CONTEXTO DEL PROYECTO

Este es un proyecto de microservicios con:
- **Backend**: NestJS + PostgreSQL (corre en WSL con Docker)
- **Frontend**: Flutter Web (corre en WSL con Docker)
- **Desarrollo**: Windows con Cursor IDE
- **Servicios**: WSL con Docker/Portainer

## ğŸ—ï¸ ARQUITECTURA

```
Windows (Cursor IDE)          WSL (Servicios Docker)
â”œâ”€â”€ /c/dev/proyecto-fct-NetJs/  â”œâ”€â”€ /opt/proyecto-fct-NetJs/
â”‚   â”œâ”€â”€ backend/                 â”‚   â”œâ”€â”€ backend/ (Stack Docker)
â”‚   â”œâ”€â”€ frontend/                â”‚   â”œâ”€â”€ frontend/ (Stack Docker)
â”‚   â””â”€â”€ scripts/                 â”‚   â””â”€â”€ proxy/ (Proxy reverso)
â”‚                                â”‚
GitHub                         Portainer
â””â”€â”€ Repositorio Ãºnico          â””â”€â”€ GestiÃ³n de stacks
```

## ğŸ“‹ REGLAS OBLIGATORIAS PARA EL AGENTE

### 1. COMANDOS DE TERMINAL
**SIEMPRE** usa estos comandos para operaciones del proyecto:

```powershell
# Para desarrollo y compilaciÃ³n (Windows)
.\scripts\cursor-agent-helper.ps1 build-backend
.\scripts\cursor-agent-helper.ps1 build-frontend
.\scripts\cursor-agent-helper.ps1 test-backend
.\scripts\cursor-agent-helper.ps1 test-frontend

# Para despliegue (sincroniza + despliega)
.\scripts\cursor-agent-helper.ps1 deploy-backend
.\scripts\cursor-agent-helper.ps1 deploy-frontend
.\scripts\cursor-agent-helper.ps1 deploy-all

# Para monitoreo
.\scripts\cursor-agent-helper.ps1 logs-backend
.\scripts\cursor-agent-helper.ps1 health-backend
.\scripts\cursor-agent-helper.ps1 status
```

### 2. FLUJO DE TRABAJO OBLIGATORIO

Cuando hagas cambios en el cÃ³digo:

1. **Editar** en Windows (Cursor detecta errores correctamente)
2. **Compilar** en Windows para verificar
3. **Commit y Push** al repositorio
4. **Desplegar** usando el helper script
5. **Verificar** health check

```powershell
# Ejemplo de flujo completo
git add .
git commit -m "feat: nueva funcionalidad"
git push origin main
.\scripts\cursor-agent-helper.ps1 deploy-backend
.\scripts\cursor-agent-helper.ps1 health-backend
```

### 3. SINCRONIZACIÃ“N TRIPLE

Mantener sincronizados:
- **Windows** (desarrollo)
- **WSL** (servicios)
- **GitHub** (repositorio)

```powershell
# DespuÃ©s de cambios importantes
git add .
git commit -m "descripciÃ³n del cambio"
git push origin main
.\scripts\cursor-agent-helper.ps1 deploy-backend
```

### 4. COMANDOS PROHIBIDOS

**NUNCA** uses estos comandos directamente:
- âŒ `docker compose` (no disponible en Windows)
- âŒ `npm run start:prod` (usa el helper)
- âŒ `flutter run` (usa el helper)
- âŒ Comandos directos de WSL sin el helper

### 5. VERIFICACIÃ“N DE CAMBIOS

DespuÃ©s de cualquier cambio:
1. Verifica que compile en Windows
2. Despliega usando el helper
3. Verifica health check
4. Revisa logs si hay problemas

```powershell
.\scripts\cursor-agent-helper.ps1 build-backend
.\scripts\cursor-agent-helper.ps1 deploy-backend
.\scripts\cursor-agent-helper.ps1 health-backend
```

### 6. DIAGNÃ“STICO RÃPIDO

Si hay problemas, ejecuta el diagnÃ³stico:
```powershell
.\scripts\diagnose.ps1
```

Este comando verificarÃ¡:
- Estado de WSL y Docker
- Servicios corriendo
- Health del backend
- Archivos crÃ­ticos
- Registro de AppController
- SincronizaciÃ³n entre Windows y WSL

## ğŸ”§ COMANDOS ESPECÃFICOS POR SERVICIO

### Backend (NestJS)
```powershell
# Desarrollo
.\scripts\cursor-agent-helper.ps1 build-backend
.\scripts\cursor-agent-helper.ps1 test-backend

# Despliegue
.\scripts\cursor-agent-helper.ps1 deploy-backend
.\scripts\cursor-agent-helper.ps1 logs-backend
.\scripts\cursor-agent-helper.ps1 health-backend
```

### Frontend (Flutter)
```powershell
# Desarrollo
.\scripts\cursor-agent-helper.ps1 build-frontend
.\scripts\cursor-agent-helper.ps1 test-frontend

# Despliegue
.\scripts\cursor-agent-helper.ps1 deploy-frontend
.\scripts\cursor-agent-helper.ps1 logs-frontend
```

## ğŸ“Š MONITOREO Y DEBUGGING

### Verificar Estado
```powershell
.\scripts\cursor-agent-helper.ps1 status
.\scripts\cursor-agent-helper.ps1 health-backend
```

### Ver Logs
```powershell
.\scripts\cursor-agent-helper.ps1 logs-backend
.\scripts\cursor-agent-helper.ps1 logs-frontend
```

### Reiniciar Servicios
```powershell
.\scripts\cursor-agent-helper.ps1 restart-backend
.\scripts\cursor-agent-helper.ps1 restart-frontend
```

## ğŸš¨ SOLUCIÃ“N DE PROBLEMAS

### Error 404 en /api/health
```powershell
# Verificar que AppController estÃ© registrado en AppModule
# Luego desplegar
.\scripts\cursor-agent-helper.ps1 deploy-backend
.\scripts\cursor-agent-helper.ps1 health-backend
```

### Contenedor "unhealthy"
```powershell
# Ver logs y reiniciar
.\scripts\cursor-agent-helper.ps1 logs-backend
.\scripts\cursor-agent-helper.ps1 restart-backend
.\scripts\cursor-agent-helper.ps1 health-backend
```

### Problemas de sincronizaciÃ³n
```powershell
# Forzar sincronizaciÃ³n
.\scripts\cursor-agent-helper.ps1 sync-backend
.\scripts\cursor-agent-helper.ps1 deploy-backend
```

## ğŸ“ BUENAS PRÃCTICAS

### âœ… HACER
- Usar SIEMPRE los scripts helper
- Hacer commits frecuentes
- Verificar health checks despuÃ©s del despliegue
- Mantener sincronizado el repositorio
- Documentar cambios importantes

### âŒ NO HACER
- Usar comandos Docker directamente desde Windows
- Ignorar errores de compilaciÃ³n
- Olvidar hacer push al repositorio
- No verificar health checks
- Editar directamente en WSL

## ğŸ¯ RESUMEN PARA EL AGENTE

1. **Desarrollo**: Windows con Cursor
2. **CompilaciÃ³n**: Windows con helper scripts
3. **Despliegue**: WSL con helper scripts
4. **Monitoreo**: Helper scripts
5. **SincronizaciÃ³n**: Git + helper scripts

**Recuerda**: Siempre usa `.\scripts\cursor-agent-helper.ps1 [comando]` para cualquier operaciÃ³n del proyecto.
